{% extends "base-main.html" %} {% load static %}{% block title %}{{ translation_data.name }}{% endblock title %}
{% block content %}
    <div class="streams-margin">
        <section class="translation">
            <h1 class="translation__title">{{ translation_data.name }}</h1>
            <div class="tranlation__container" style="background-image: url('{{ translation_data.preview.url }}')">
                <p class="translation__info_day-n-year translation__info">{{ translation_data.date }}</p>
                <p class="translation__info_hour translation__info">{{ translation_data.time }} (GMT+03:00)</p>
                <h2 class="translation__info_title translation__info bold2">{{ translation_data.name }}</h2>
                <!-- подписка данная у пользователя не равна подписке которая должна быть на этой трансляции-->
                {% if user_data.sub.sub_category != translation_data.category and if_ultimate != "Ultimate" or end_sub == True%}
                    <button class="translation__buy-btn btn-no-style" onclick="window.location='{% url 'subs' %}';"><p
                            class="bold2" style="margin:0; white-space: nowrap;">Купить подписку</p> <br>
                        <p style="margin:0; font-weight: 200;">от 299р</p></button>
                    <div class="translation__bottom-elems">
                        <button class="translation__error-btn btn-no-style trans-bottom-btns">Сообщить о проблеме
                        </button>
                        <button class="translation__user-agreement btn-no-style trans-bottom-btns">Пользовательское
                            соглашение
                        </button>
                    </div>
                {% elif user_data.sub.sub_category == translation_data.category or if_ultimate == "Ultimate" and end_sub == False%}
                    <script type="text/javascript">
                        let url = `ws://${window.location.host}/ws/socket-server/{{ pk }}/`
                        const viewStream = new WebSocket(url)
                        viewStream.onmessage = function(e){
                            let data = JSON.parse(e.data);
                            console.log("DATA: ", data);

                        }

                    </script>
                {% endif %}
            </div>
            <div class="translation__members-counter"><img src="{% static 'image/icons8-ñÑGÑ¬G¿ó-24.png' %}"
                                                           alt="users">
                <p class="translation__members-count">{{ translation_data.online }}</p>
            </div>
            <p class="translation__description">{{ translation_data.category }}</p>
            <section class="comments">
                <h2 class="comments__title">Комментарии</h2>
                {% for i in comments %}

                    <article class="comments__comment">
                        <h2 class="comments__name">{{ i.author }}</h2>
                        <p class="comments__comment-text">{{ i.text }}</p>
                    </article>
                {% endfor %}
            </section>
            {% if request.user.is_authenticated %}
                <form action="{% url 'chat' translation_data.pk %}" class="post__comment" method="post">
                    {% csrf_token %}
                    <textarea name="comment" id="comment" cols="30" rows="10" class="post__textarea"
                              placeholder="Оставьте свой комментарий..."></textarea>
                    <button class="post__comment-btn btn-no-style">Отправить</button>
                </form>
            {% else %} {% endif %}
        </section>
        </section>
        <div class="px2"></div>
    </div>
{% endblock content %}